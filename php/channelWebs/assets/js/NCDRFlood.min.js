function cancelNCDRFloodSubArea(a){var b=document.getElementById("subc__desc"),c=document.getElementById("subc__btnblock"),d=document.getElementById("subc__table"),e=document.getElementById("subc__infoaction"),f={area:[a.dataset.areacode.toString()]};f=JSON.stringify(f);var g={authToken:AUTH_TOKEN,memberId:a.dataset.mid,datasetId:a.value,subscribeDetail:f,todo:a.dataset.action},h=API_HOST+SRU+"/updateSubscriptionContainer/";$.ajax({url:h,data:JSON.stringify(g),dataType:"json",method:"PUT",async:!1}).done(function(f){return f.result===!1?void alert("您已訂閱過本服務"):(b.innerHTML='<span class="subc__support">已為您取消'+SUBSCRIBE_TYPE[a.value]+"-【"+getGeocodeName(TAIWAN_POSTWITHGEO_CODE_TPE[a.dataset.postcode])+"】服務!</span>",c.innerHTML='<button style="margin-top: 5px;" class="sbtn--want" onclick="location.reload();">繼續訂閱其他區域</button>',d.innerHTML="",void(e.innerHTML=""))}).fail(function(a,b,c){})}function addNCDRFloodSubArea(a){var b=document.getElementById("subc__desc"),c=document.getElementById("subc__btnblock"),d=document.getElementById("subc__table"),e=document.getElementById("subc__infoaction"),f={area:[a.dataset.areacode.toString()]};f=JSON.stringify(f);var g={authToken:AUTH_TOKEN,memberId:a.dataset.mid,datasetId:a.value,subscribeDetail:f,todo:a.dataset.action},h=API_HOST+SRU+"/updateSubscriptionContainer/";$.ajax({url:h,data:JSON.stringify(g),dataType:"json",method:"PUT",async:!1}).done(function(f){return f.result===!1?void alert("您已訂閱過本服務"):(b.innerHTML='<span class="subc__support">您已完成訂閱【'+getGeocodeName(TAIWAN_POSTWITHGEO_CODE_TPE[a.dataset.postcode])+"】的淹水資訊 ，如欲訂閱其他行政區，請點擊下方按鈕。</span>",c.innerHTML='<button style="margin-top: 5px;" class="sbtn--want" onclick="location.reload();">繼續訂閱其他區域</button>',d.innerHTML="",void(e.innerHTML=""))}).fail(function(a,b,c){})}function showInfo(a,b){var c=document.getElementById("subc__desc"),d=document.getElementById("subc__infoaction"),e=document.getElementById("subc__btnblock"),f=document.getElementById("subc__table"),g={memberId:getURIQueryString("mid"),datasetId:getURIQueryString("did"),authToken:AUTH_TOKEN,areaCode:a.value},h=API_HOST+SRU+"/listDataset/";$.ajax({url:h,data:g,dataType:"json",method:"GET",async:!0}).done(function(h){c.innerHTML='<span class="subc__support">按下「我要訂閱【ＯＯ區】的淹水資訊」，當有淹水警示時，我們將會用LINE訊息通知您。</span>';var i=document.createElement("br");if(h.result===!1)return void alert("此區域尚無此服務");f.innerHTML="",e.innerHTML="";JSON.parse(h.data);d.innerHTML="",d.appendChild(i);var k=document.createElement("button");k.className="sbtn--want",k.innerHTML="我要訂閱【"+getGeocodeName(TAIWAN_POSTWITHGEO_CODE_TPE[a.dataset.postcode])+"】的淹水資訊",k.value=g.datasetId,k.setAttribute("data-action","addArea"),k.setAttribute("data-postcode",a.dataset.postcode),k.setAttribute("data-areacode",g.areaCode),k.setAttribute("data-mid",g.memberId);var l=document.createElement("button");l.className="back",l.setAttribute("onclick","location.reload()"),"addNewArea"===b?k.setAttribute("onclick","addNCDRFloodSubArea(this)"):k.setAttribute("onclick","addSub(this)"),d.appendChild(k),d.appendChild(i),d.appendChild(l)}).fail(function(a,b,c){})}window.addEventListener("load",function(a){document.addEventListener("deviceready",function(a){document.addEventListener("touchstart",function(a){a.stopPropagation()},!1);var b={pageKey:"NCDRFlood",entryPage:!1,titleBar:{left:{imgId:"btn_default",text:"zh-tw"===navigator.language?"回首頁":"Home",visible:!0,enable:!0},center:{text:"防汛資訊訂閱平台",clickable:!1}}};LCS.Interface.updateTitleBar(b),LCS.Interface.registerTitleBarCallback(function(a){switch(a.target){case"LBUTTON":window.history.back();break;case"RBUTTON":break;case"BACK":window.history.back();break;case"TITLE":}});var c=document.getElementById("subc__desc"),d=document.getElementById("subc__btnblock"),e=document.getElementById("subc__infoaction"),f={memberId:getURIQueryString("mid"),datasetId:getURIQueryString("did"),authToken:AUTH_TOKEN,st:(new Date).getTime()},g=API_HOST+SRU+"/listSubscriptionContainer/";$.ajax({url:g,data:f,dataType:"json",method:"GET",async:!0}).done(function(a){if(a.result!==!1){var h={100:{6300500:"中正區"},103:{6300600:"大同區"},104:{6300400:"中山區"},105:{6300100:"松山區"},106:{6300300:"大安區"},108:{6300700:"萬華區"},110:{6300200:"信義區"},111:{6301100:"士林區"},112:{6301200:"北投區"},114:{6301000:"內湖區"},115:{6300900:"南港區"},116:{6300800:"文山區"}},i=document.getElementById("subcedInfo"),j=JSON.parse(a.data),k=JSON.parse(j[0].detail);c.innerHTML='<span class="subc__support">您已訂閱下列資訊</span>';for(var b=0;b<13;b++)if("undefined"!=typeof k.area[b]){var o,l=document.createElement("tr"),m=document.createElement("td"),n=document.createElement("button");for(var p in TAIWAN_POSTWITHGEO_CODE_TPE)if(k.area[b]===getGeocode(TAIWAN_POSTWITHGEO_CODE_TPE[p])){var q=getGeocodeName(TAIWAN_POSTWITHGEO_CODE_TPE[p]);o=p,delete h[p]}n.setAttribute("data-postcode",o),n.className="sbtn--cancel",n.value=f.datasetId,n.innerHTML="【"+q+"】取消訂閱",n.setAttribute("data-action","cancelArea"),n.setAttribute("data-areacode",k.area[b]),n.setAttribute("data-mid",f.memberId),n.setAttribute("onclick","cancelNCDRFloodSubArea(this)"),m.appendChild(n),l.appendChild(m),i.appendChild(l)}if(!objIsEmpty(h)){e.innerHTML='<span class="subc__support" style="color:#000;">繼續訂閱下列項目</span><br>';for(var p in h){var r=document.createElement("button");r.value=getGeocode(h[p]),r.className="areaBtn",r.setAttribute("data-postcode",p),r.setAttribute("onclick","showInfo(this, 'addNewArea')"),r.innerHTML=getGeocodeName(h[p]),e.appendChild(r)}}}else{c.innerHTML='<span class="subc__support">按下「行政區」，再按下「我要訂閱【ＯＯ區】的淹水資訊」，當有淹水警示時，我們將會用LINE訊息通知您。</span>';for(var b in TAIWAN_POSTWITHGEO_CODE_TPE){var g=document.createElement("button");g.className="areaBtn",g.value=getGeocode(TAIWAN_POSTWITHGEO_CODE_TPE[b]),g.setAttribute("data-postcode",b),g.setAttribute("onclick","showInfo(this)"),g.innerHTML=getGeocodeName(TAIWAN_POSTWITHGEO_CODE_TPE[b]),d.appendChild(g)}}}).fail(function(a,b,c){})},!1)});
